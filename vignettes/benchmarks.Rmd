---
title: "Benchmarking results and comparision with other packages"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Benchmarking results and comparision with other packages}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
devtools::load_all()
set.seed(2022)
```


## Microbenchmarks for Development

### A. Scaling with network size

```{r, eval = FALSE, echo = FALSE}
results <- bench::press(
  Nsize = c(10, 100, 1000),
  {
    G <- sample_ppm2(Nsize, c=0.9, k=3, B=3)
    G <- simplify(G)
    G <- delete.vertices(G, degree(G) == 0)
    p <- sample(1:3, Nsize, replace = TRUE)
    bench::mark(
      min_iterations = 5,
      node_count = block_node_counts(p),
      edge_count = block_edge_counts(G, p),
      entropy = get_entropy(G, p),
      mcmc_sweep = mcmc_single_sweep(G, p, 3),
      check = FALSE
    )
  }
)
results
```



### B. Entropy Convergence Tests

#### 1. MCMC sweeps

```{r, eval = FALSE, echo = FALSE}
# Initialize graph and a random starting partition
Nsize = 60
G <- sample_ppm2(Nsize, c = 0.9, k = 10, B = 3)
G <- simplify(G)
G <- delete.vertices(G, degree(G) == 0)

# Number of mcmcm sweeps
Niter = 50
start_partition <- sample(1:3, size = Nsize, replace = TRUE)

# Perform Niter mcmc sweeps
result <- mcmc_sweep(G, start_partition, 3, n.sweeps = 50)

# Visualize start/end partition and entropy delta.
plot(G, vertex.color = start_partition, vertex.label = NA)
plot(result$entropy_delta, type = "line")
plot(G, vertex.color = result$best_partition, vertex.label = NA)
```


#### 2. Agglomerative Merge

```{r, eval = FALSE, echo = FALSE}
G <- sample_ppm2(300, 0.95, 10, 6)
G <- simplify(G)
E <- length(E(G))
p.start <- sample(1:30, length(G), replace=TRUE)
p.start <- check_partition(p.start)
p.new <- p.start
dS <- c(0)
dB <- c(max(p.new))
while(max(p.new) > 1){
   B.curr <- max(p.new)
   n.merges <- B.curr - floor(B.curr/1.5)
   cb <- collapse_step(G, p.new, n.merges = n.merges, n.sweeps = 2)
   p.new <- cb$new_partition
   dS <- append(dS, cb$entropy_delta)
   dB <- append(dB, max(p.new))
   plot(G, vertex.color = p.new, vertex.label = NA)
}
plot(dB, dS, type = "line")
```
