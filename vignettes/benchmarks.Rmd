---
title: "Benchmarking results and comparision with other packages"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Benchmarking results and comparision with other packages}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
devtools::load_all()
set.seed(2022)
```


## Microbenchmarks for Development

### A. Scaling with network size

```{r scaling}
results <- bench::press(
  Nsize = c(10, 100, 1000),
  {
    G <- sample_ppm(Nsize, 0.1, 0.01, c(0.3*Nsize, 0.5*Nsize, 0.2*Nsize))
    p <- c(rep(1, 0.3*Nsize), rep(2, 0.5*Nsize), rep(3, 0.2*Nsize))
    bench::mark(
      min_iterations = 50,
      node_count = block_node_counts(p, 3),
      edge_count = block_edge_counts(G, p, 3),
      entropy = get_entropy(G, p, 3),
      mcmc_sweep = mcmc_sweep(G, p, 3),
      check = FALSE
    )
  }
)
results
```


### B. Big Dataset (2.5 million vertices)

#### B1. Calculate entropy / edge list

```{r data}
Nsize = 150000
G <- sample_ppm(Nsize, 0.001, 0.0001, c(0.3*Nsize, 0.5*Nsize, 0.2*Nsize))
p <- sample(c(rep(1,.3*Nsize), rep(2,.5*Nsize), rep(3,.2*Nsize)))
start.time <- Sys.time()
for(i in 1:5) S <- get_entropy(G, p)
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken/5
```


### C. Entropy Convergence Test

```{r, eval = FALSE, echo = FALSE}
Nsize = 100
Niter = 1500
G <- sample_ppm(Nsize, 0.99, 0.01, c(0.3*Nsize, 0.5*Nsize, 0.2*Nsize))
E <- length(E(G))
p.true <- c(rep(1,.3*Nsize), rep(2,.5*Nsize), rep(3,.2*Nsize))
p.start <- sample(1:3, Nsize, replace = TRUE)
p.new <- p.start
p.best <- p.start
S.iter <- rep(get_entropy(G, p.start)/E, Niter)
pb = txtProgressBar(min = 0, max = Niter, initial = 1, style = 3) 
start.time <- Sys.time()
for (i in 2:Niter) {
  p.new <- mcmc_sweep(G, p.best, 3)
  S.iter[i] <- get_entropy(G, p.new, 3)/E
  if(S.iter[i] == min(S.iter)) p.best <- p.new
  setTxtProgressBar(pb,i)
}
close(pb)
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken/(Niter-1)
```
